<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Geometry Dash - Game</title>
<style>
body { margin: 0; font-family: Arial, sans-serif; background: #222; color: white; }
#menu { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
#menu button { margin: 5px; padding: 10px 20px; cursor: pointer; font-size: 16px; }
canvas { display: block; margin: 0 auto; background: #222; }
#scoreboard { position: fixed; top: 10px; right: 10px; color: white; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; }
#debug { position: fixed; bottom: 10px; right: 10px; color: lime; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px; display: none; }
</style>
</head>
<body>
<div id="menu">
    <h1>Geometry Dash</h1>
    <p>Select a level to start:</p>
    <div id="levelButtons"></div>
    <button onclick="logout()">Logout</button>
</div>
<canvas id="gameCanvas" width="800" height="400" style="display:none;"></canvas>
<div id="scoreboard" style="display:none;">
  Score: <span id="score">0</span><br>
  High Score: <span id="highscore">0</span>
</div>
<div id="debug">
  Debug Mode Active<br>
  User: <span id="debugUser"></span>
</div>

<script>
const currentUser = localStorage.getItem('currentUser');
if(!currentUser) {
    window.location.href = 'login.html';
}

const debugMode = currentUser === 'RobTop';
document.getElementById('debugUser').innerText = currentUser;
if(debugMode) document.getElementById('debug').style.display = 'block';

let level = 1;

// Create level selection buttons
const levelButtonsContainer = document.getElementById('levelButtons');
for(let i=1;i<=7;i++){
    const btn = document.createElement('button');
    btn.innerText = 'Level ' + i;
    btn.onclick = () => startGame(i);
    levelButtonsContainer.appendChild(btn);
}

// Logout
function logout(){
    localStorage.removeItem('currentUser');
    window.location.href = 'login.html';
}

// Game Variables
let canvas, ctx, player, obstacles, score, highscore, gameInterval;

function startGame(selectedLevel){
    level = selectedLevel;
    document.getElementById('menu').style.display = 'none';
    canvas = document.getElementById('gameCanvas');
    ctx = canvas.getContext('2d');
    canvas.style.display = 'block';
    document.getElementById('scoreboard').style.display = 'block';

    player = {x:50, y:300, width:30, height:30, dy:0, onGround:true};
    obstacles = [];
    score = 0;
    highscore = parseInt(localStorage.getItem('highscore_' + currentUser) || '0');
    document.getElementById('highscore').innerText = highscore;

    document.addEventListener('keydown', e => {
        if(e.code === 'Space' && player.onGround){
            player.dy = -15;
            player.onGround = false;
        }
    });

    if(gameInterval) clearInterval(gameInterval);
    gameInterval = setInterval(spawnObstacle, 2000 / level);

    update();
}

// Obstacles
function spawnObstacle() {
    obstacles.push({x: canvas.width, y: 350, width: 30, height: 50});
}

// Game loop
function update() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Player physics
    player.dy += 1;
    player.y += player.dy;
    if(player.y + player.height >= 380){
        player.y = 380 - player.height;
        player.dy = 0;
        player.onGround = true;
    }

    // Draw player
    ctx.fillStyle = 'cyan';
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Obstacles
    for(let i=0;i<obstacles.length;i++){
        let ob = obstacles[i];
        ob.x -= 5 + level;
        ctx.fillStyle = 'red';
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);

        // Collision
        if(player.x < ob.x + ob.width && player.x + player.width > ob.x &&
           player.y < ob.y + ob.height && player.y + player.height > ob.y){
            gameOver();
            return;
        }
    }

    obstacles = obstacles.filter(ob => ob.x + ob.width > 0);

    // Score
    score++;
    document.getElementById('score').innerText = score;

    requestAnimationFrame(update);
}

// Game over
function gameOver(){
    if(score > highscore){
        highscore = score;
        localStorage.setItem('highscore_' + currentUser, highscore);
    }
    alert('Game Over! Score: ' + score);
    document.getElementById('menu').style.display = 'flex';
    canvas.style.display = 'none';
    document.getElementById('scoreboard').style.display = 'none';
}
</script>
</body>
</html>
