<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CreepyChat — HTML single-file</title>
  <style>
    :root{--bg:#0b0f14;--panel:#0f1720;--muted:#9aa4ad;--accent:#7c3aed}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071018 0%, #0b0f14 100%);color:#e6eef6}
    .app{max-width:900px;margin:28px auto;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:10px;align-items:center}
    .panel{background:var(--panel);padding:12px;border-radius:10px}

    .chat{height:420px;overflow:auto;padding:14px;border-radius:8px;background:rgba(0,0,0,0.12);margin-bottom:12px}
    .msg{margin-bottom:12px;display:flex;gap:10px}
    .msg.me{justify-content:flex-end}
    .bubble{max-width:72%;padding:10px 12px;border-radius:10px;background:rgba(255,255,255,0.03);backdrop-filter: blur(2px);}
    .bubble.bot{background:linear-gradient(90deg, rgba(124,58,237,0.08), rgba(255,255,255,0.02));}
    .meta{font-size:12px;color:var(--muted);margin-bottom:6px}

    .inputRow{display:flex;gap:8px}
    input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:white;cursor:pointer}

    .settings{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
    .setting{display:flex;gap:6px;align-items:center}
    .small{font-size:13px;color:var(--muted)}

    /* glitch effects */
    .glitch{position:relative}
    .glitch::before,.glitch::after{content:attr(data-text);position:absolute;left:0;top:0;width:100%;overflow:hidden;clip:rect(0,900px,0,0)}
    .glitch.glitch-1::before{animation:glitch-anim 1.2s infinite;transform:translate(-1px,0);color:#ff4d4d;opacity:0.8}
    .glitch.glitch-1::after{animation:glitch-anim2 1.8s infinite;transform:translate(1px,0);color:#55ffb0;opacity:0.6}
    @keyframes glitch-anim{0%{clip:rect(10px,9999px,50px,0)}20%{clip:rect(85px,9999px,130px,0)}40%{clip:rect(10px,9999px,50px,0)}60%{clip:rect(60px,9999px,120px,0)}80%{clip:rect(0,9999px,20px,0)}100%{clip:rect(10px,9999px,50px,0)}}
    @keyframes glitch-anim2{0%{clip:rect(20px,9999px,40px,0)}25%{clip:rect(70px,9999px,110px,0)}50%{clip:rect(15px,9999px,60px,0)}75%{clip:rect(90px,9999px,140px,0)}100%{clip:rect(20px,9999px,40px,0)}}

    /* overlay / jumpscare */
    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);z-index:9999;flex-direction:column}
    .overlay h2{font-size:36px;margin:0 0 12px 0;color:white}
    .overlay p{color:var(--muted);margin:0 0 18px}
    .danger{background:#111;border:2px solid #7c3aed;padding:20px;border-radius:10px}
    .muted-note{font-size:13px;color:var(--muted);margin-top:8px}

    footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px}

    /* corrupted UI */
    .broken{filter:hue-rotate(40deg) saturate(1.6) contrast(1.2)}
    .flicker{animation:flicker 0.18s steps(2) infinite}
    @keyframes flicker{0%{opacity:1}50%{opacity:0.6}100%{opacity:1}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>CreepyChat — HTML single-file</h1>
      <div class="controls small">
        <span id="lvl">Creep level: 0</span>
      </div>
    </header>

    <div class="panel">
      <div class="settings" id="settings">
        <label class="setting small"><input type="checkbox" id="enableJumps"> Enable jumpscares</label>
        <label class="setting small"><input type="checkbox" id="requireConfirm" checked> Require confirm for jumpscare</label>
        <label class="setting small"><input type="checkbox" id="hebrewVoice" checked> Hebrew speech</label>
        <label class="setting small">Max intensity: <input id="maxInt" type="number" value="12" style="width:70px;margin-left:6px"></label>
      </div>

      <div class="chat" id="chat" aria-live="polite"></div>

      <div class="inputRow">
        <input id="userInput" type="text" placeholder="Say something..." autocomplete="off">
        <button id="sendBtn">Send</button>
      </div>

      <div class="muted-note">Jumpscares are <strong>off</strong> by default. Enable them intentionally. The bot will speak Hebrew when configured.</div>
    </div>

    <footer>
      <div class="small">Save this file locally and open it in a modern browser.</div>
      <div class="small">Created for experimentation — use responsibly.</div>
    </footer>
  </div>

  <!-- overlay template (created dynamically) -->

  <script>
    (function(){
      // State
      const chat = document.getElementById('chat');
      const input = document.getElementById('userInput');
      const sendBtn = document.getElementById('sendBtn');
      const lvl = document.getElementById('lvl');
      const enableJumps = document.getElementById('enableJumps');
      const requireConfirm = document.getElementById('requireConfirm');
      const hebrewVoice = document.getElementById('hebrewVoice');
      const maxInt = document.getElementById('maxInt');

      let messages = [];
      let creepLevel = Number(localStorage.getItem('creepLevel')||0);
      let settings = JSON.parse(localStorage.getItem('cc-html-settings')||JSON.stringify({jumps:false,requireConfirm:true,hebrew:true,maxIntensity:12}));

      // apply saved settings
      enableJumps.checked = settings.jumps;
      requireConfirm.checked = settings.requireConfirm;
      hebrewVoice.checked = settings.hebrew;
      maxInt.value = settings.maxIntensity;

      lvl.textContent = 'Creep level: ' + creepLevel;

      // initial bot message
      addBot('שלום — Hi, I am CreepyChat. Say something.','normal');

      function saveState(){
        localStorage.setItem('creepLevel', String(creepLevel));
        localStorage.setItem('cc-html-settings', JSON.stringify({jumps:enableJumps.checked,requireConfirm:requireConfirm.checked,hebrew:hebrewVoice.checked,maxIntensity:Number(maxInt.value)}));
      }

      function appendMessage(from, text, type=''){
        const wrap = document.createElement('div');
        wrap.className = 'msg ' + (from==='me'?'me':'');
        const bubble = document.createElement('div');
        bubble.className = 'bubble ' + (from==='bot'?'bot':'');
        bubble.innerHTML = '<div class="meta">' + (from==='me'? 'You' : 'CreepyChat') + '</div>' + '<div class="content">' + text + '</div>';
        if(type && type.startsWith('glitch')){
          bubble.classList.add('glitch');
          bubble.setAttribute('data-text', text);
        }
        if(type && type.includes('broken')){
          bubble.classList.add('broken');
        }
        wrap.appendChild(bubble);
        chat.appendChild(wrap);
        chat.scrollTop = chat.scrollHeight;
      }

      function addBot(text, mode=''){
        appendMessage('bot', escapeHtml(text), mode);
        if(hebrewVoice.checked) speakHebrew(text);
      }

      function escapeHtml(unsafe){
        return unsafe.replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m];});
      }

      function speakHebrew(text){
        if(!('speechSynthesis' in window)) return;
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'he-IL';
        // Try to pick a Hebrew voice if available
        const voices = speechSynthesis.getVoices();
        const v = voices.find(x=>x.lang && x.lang.startsWith('he')) || voices.find(x=>x.lang && x.lang.startsWith('en')) || voices[0];
        if(v) utter.voice = v;
        utter.rate = 0.95;
        utter.pitch = 0.9;
        speechSynthesis.speak(utter);
      }

      // simple generator that corrupts over time
      function generateReply(userText){
        const basic = [
          'I see. Tell me more.',
          'Interesting... go on.',
          'Why do you say that?',
          'מה אתה רואה? (What do you see?)'
        ];
        const lvl = creepLevel;
        if(lvl < 3) return pick(basic);
        if(lvl < 6) return pick(basic) + ' ' + corrupt(userText, Math.min(2,lvl-2));
        if(lvl < 9) return mixedHebrew(pick(basic) + ' ' + corrupt(userText, 3));
        // high creep: very corrupted and short
        return corruptedShort(lvl);
      }

      function pick(arr){return arr[Math.floor(Math.random()*arr.length)];}

      function corrupt(text, times){
        let t = text || '';
        for(let i=0;i<times;i++){
          t = t.split('').map(c=>Math.random()<0.12? randomChar() : c).join('');
          if(Math.random()<0.35) t = insertGibberish(t);
        }
        return t || insertGibberish('...');
      }

      function randomChar(){
        const pool = 'אבגדהוזחטיכלמנסעפצקרשת!@#$%^&*()[]{}<>?/\\|~0123456789';
        return pool[Math.floor(Math.random()*pool.length)];
      }

      function insertGibberish(s){
        const gib = '₪₪₪***---כץכץ';
        const pos = Math.floor(Math.random()* (s.length+1));
        return s.slice(0,pos)+gib+s.slice(pos);
      }

      function mixedHebrew(s){
        // sprinkle some Hebrew phrases
        const h = ['אני רואה אותך','חכה','אל תברח','מה נשאר'];
        return s + ' — ' + h[Math.floor(Math.random()*h.length)];
      }

      function corruptedShort(lvl){
        const parts = ['חכה', 'רואה', 'אתה', 'לך', 'אלי', '...','₪₪'];
        const take = Math.min(parts.length, 3 + (lvl-8));
        return parts.slice(0,take).join(' ');
      }

      function escalate(){
        creepLevel = Math.min(Number(maxInt.value)||12, creepLevel + 1);
        lvl.textContent = 'Creep level: ' + creepLevel;
        saveState();
        // visual corruption when high
        if(creepLevel >= 5){
          document.querySelector('.app').classList.add('broken');
        }
        if(creepLevel >= 8){
          document.querySelector('.app').classList.add('flicker');
        }
        if(creepLevel >= Number(maxInt.value || 12) && enableJumps.checked){
          maybeJumpscare();
        }
      }

      function maybeJumpscare(){
        if(requireConfirm.checked){
          const ok = confirm('Jumpscare available — allow now? (enable Require Confirm in settings to always prompt)');
          if(!ok) return;
        }
        doJumpscare();
      }

      function doJumpscare(){
        // create overlay
        const overlay = document.createElement('div');
        overlay.className = 'overlay';
        overlay.innerHTML = '<div class="danger"><h2>יש! (BOO)</h2><p>— CreepyChat —</p><button id="closeOverlay">Close</button></div>';
        document.body.appendChild(overlay);
        document.getElementById('closeOverlay').focus();
        // play audio: short burst using WebAudio
        try{
          const ctx = new (window.AudioContext||window.webkitAudioContext)();
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = 'sawtooth';
          o.frequency.value = 220;
          g.gain.value = 0.0001;
          o.connect(g);g.connect(ctx.destination);
          o.start();
          // quick ramp up & noise
          g.gain.linearRampToValueAtTime(0.25, ctx.currentTime + 0.02);
          setTimeout(()=>{g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.12);o.stop();},140);
        }catch(e){/* ignore audio errors */}
        overlay.addEventListener('click', ()=>overlay.remove());
        // big visual flash
        flashScreen();
      }

      function flashScreen(){
        const flash = document.createElement('div');
        flash.style.position='fixed';flash.style.inset='0';flash.style.background='white';flash.style.zIndex=9998;flash.style.opacity='0';flash.style.transition='opacity 80ms';
        document.body.appendChild(flash);
        requestAnimationFrame(()=>{flash.style.opacity='1';});
        setTimeout(()=>{flash.style.opacity='0';setTimeout(()=>flash.remove(),120)},100);
      }

      // UI handlers
      sendBtn.addEventListener('click', onSend);
      input.addEventListener('keydown', (e)=>{if(e.key==='Enter') onSend();});

      enableJumps.addEventListener('change', saveState);
      requireConfirm.addEventListener('change', saveState);
      hebrewVoice.addEventListener('change', saveState);
      maxInt.addEventListener('change', saveState);

      function onSend(){
        const text = input.value.trim();
        if(!text) return;
        appendMessage('me', escapeHtml(text));
        input.value = '';
        // escalate creep level
        escalate();
        // generate bot reply
        setTimeout(()=>{
          const reply = generateReply(text);
          // pick visual style based on creepLevel
          let style = '';
          if(creepLevel >= 8) style = 'glitch-1 broken';
          else if(creepLevel >=5) style = 'glitch-1';
          addBot(reply, style);
        }, 450 + Math.random()*700);
      }

      // small helper: seed chat with a few messages if empty
      function seedIfEmpty(){
        if(localStorage.getItem('cc-html-seed')) return;
        localStorage.setItem('cc-html-seed','1');
        setTimeout(()=>addBot('היי. אני כאן.'),800);
      }
      seedIfEmpty();

      // small utilities
      function randomInt(n){return Math.floor(Math.random()*n)}

    })();
  </script>
</body>
</html>
