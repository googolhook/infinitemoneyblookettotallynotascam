<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game with Debug Panel</title>
<style>
body {
  background: #111;
  color: #0f0;
  font-family: monospace;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  margin: 0;
  height: 100vh;
}
h1, h3 { margin: 10px; text-align: center; }
canvas { background: #222; border: 2px solid #0f0; display: none; }
button, input, select {
  margin: 5px;
  padding: 5px 10px;
  border: 2px solid #0f0;
  background: #111;
  color: #0f0;
  cursor: pointer;
}
button:hover, input:focus, select:focus {
  background: #0f0;
  color: #111;
  outline: none;
}
#score { font-size: 1.5em; margin-top: 10px; display: none; }
#debugPanel { display: none; border: 2px dashed #f0f; padding: 10px; margin-top: 10px; width: 300px; text-align: center; }
#debugContent { display: none; margin-top: 10px; }
#scoreboard { margin-top: 15px; }
table { border-collapse: collapse; width: 300px; margin: auto; }
th, td { border: 1px solid #0f0; padding: 5px; text-align: center; }
th { background: #0a0; }
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
  <h1>Snake Game</h1>
  <h3>Login</h3>
  <input id="loginUsername" placeholder="Username"><br>
  <input id="loginPassword" type="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
  <button id="toSignupBtn">Sign Up</button>
  <button id="resetPasswordBtn">Reset Password</button>
</div>

<!-- SIGNUP SCREEN -->
<div id="signupScreen" style="display:none;">
  <h1>Snake Game</h1>
  <h3>Create Account</h3>
  <input id="signupUsername" placeholder="Username"><br>
  <input id="signupPassword" type="password" placeholder="Password"><br>
  <input id="signupEmail" type="email" placeholder="Email"><br>
  <button id="signupBtn">Sign Up</button>
  <button id="backToLoginBtn">Back</button>
</div>

<!-- START SCREEN -->
<div id="startScreen" style="display:none;">
  <h1>Snake Game</h1>
  <div id="playerInfo"></div>
  <label>Difficulty:</label>
  <select id="difficulty">
    <option value="200">Easy</option>
    <option value="120" selected>Medium</option>
    <option value="70">Hard</option>
  </select><br>
  <button id="startBtn">Start Game</button>
  <button id="logoutBtn">Logout</button>

  <!-- DEBUG PANEL -->
  <div id="debugPanel">
    <button id="debugToggle">Debug Panel â–¼</button>
    <div id="debugContent">
      <label>User:</label><br>
      <select id="userSelect"></select><br>
      <label>Points: <span id="pointsValue">10</span></label><br>
      <input id="pointsRange" type="range" min="1" max="100" value="10"><br>
      <button id="givePointsBtn">Add Points</button>
      <button id="removePointsBtn">Remove Points</button><br>
      <button id="changePasswordBtn">Change Password</button>
      <button id="changeUsernameBtn">Change Username</button>
    </div>
  </div>

  <div id="scoreboard">
    <h3>Scoreboard</h3>
    <table id="scoreTable"><tr><th>Player</th><th>High Score</th></tr></table>
  </div>
</div>

<canvas id="game" width="400" height="400"></canvas>
<div id="score">Score: 0</div>

<script>
/* ==== GLOBAL VARIABLES ==== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const box = 20;
let snake, food, d, gameInterval, score, speed;
let currentUser = localStorage.getItem("snakeCurrentUser") || null;

/* ==== DOM ELEMENTS ==== */
const loginScreen = document.getElementById("loginScreen");
const signupScreen = document.getElementById("signupScreen");
const startScreen = document.getElementById("startScreen");
const loginBtn = document.getElementById("loginBtn");
const signupBtn = document.getElementById("signupBtn");
const toSignupBtn = document.getElementById("toSignupBtn");
const backToLoginBtn = document.getElementById("backToLoginBtn");
const resetPasswordBtn = document.getElementById("resetPasswordBtn");
const logoutBtn = document.getElementById("logoutBtn");
const startBtn = document.getElementById("startBtn");
const difficultySelect = document.getElementById("difficulty");
const scoreDisplay = document.getElementById("score");
const playerInfo = document.getElementById("playerInfo");
const scoreTable = document.getElementById("scoreTable");

/* ==== DEBUG ELEMENTS ==== */
const debugPanel = document.getElementById("debugPanel");
const debugToggle = document.getElementById("debugToggle");
const debugContent = document.getElementById("debugContent");
const userSelect = document.getElementById("userSelect");
const pointsRange = document.getElementById("pointsRange");
const pointsValue = document.getElementById("pointsValue");
const givePointsBtn = document.getElementById("givePointsBtn");
const removePointsBtn = document.getElementById("removePointsBtn");
const changePasswordBtn = document.getElementById("changePasswordBtn");
const changeUsernameBtn = document.getElementById("changeUsernameBtn");

/* ==== USER MANAGEMENT ==== */
function loadUsers(){ return JSON.parse(localStorage.getItem("snakeUsers"))||{}; }
function saveUsers(users){ localStorage.setItem("snakeUsers", JSON.stringify(users)); }

function updateScoreboard(){
  const users = loadUsers();
  const sorted = Object.entries(users).sort((a,b)=>b[1].highScore - a[1].highScore);
  scoreTable.innerHTML = "<tr><th>Player</th><th>High Score</th></tr>";
  sorted.forEach(([name,data])=>{
    const tr = document.createElement("tr");
    tr.innerHTML=`<td>${name}</td><td>${data.highScore}</td>`;
    if(name===currentUser) tr.style.background="#0a0";
    scoreTable.appendChild(tr);
  });
}

function updateUserDropdown(){
  const users = loadUsers();
  userSelect.innerHTML="";
  for(const user in users){
    const opt=document.createElement("option");
    opt.value=user; opt.textContent=user; userSelect.appendChild(opt);
  }
  if(currentUser) userSelect.value = currentUser;
}

/* ==== SCREEN NAVIGATION ==== */
toSignupBtn.onclick=()=>{ loginScreen.style.display="none"; signupScreen.style.display="block"; };
backToLoginBtn.onclick=()=>{ signupScreen.style.display="none"; loginScreen.style.display="block"; };

/* ==== LOGIN ==== */
loginBtn.onclick=()=>{
  const u = document.getElementById("loginUsername").value.trim();
  const p = document.getElementById("loginPassword").value.trim();
  const users = loadUsers();
  if(!u || !p) return alert("Enter username and password!");
  if(!users[u]) return alert("User does not exist!");
  if(users[u].password!==p) return alert("Incorrect password!");
  currentUser = u;
  localStorage.setItem("snakeCurrentUser",currentUser);
  showStartScreen();
};

/* ==== SIGNUP ==== */
signupBtn.onclick=()=>{
  const u = document.getElementById("signupUsername").value.trim();
  const p = document.getElementById("signupPassword").value.trim();
  const e = document.getElementById("signupEmail").value.trim();
  if(!u||!p||!e) return alert("Fill all fields!");
  const users = loadUsers();
  if(users[u]) return alert("Username exists!");
  users[u] = {password:p,email:e,highScore:0};
  saveUsers(users);
  alert("Account created!");
  signupScreen.style.display="none"; loginScreen.style.display="block";
};

/* ==== PASSWORD RESET ==== */
resetPasswordBtn.onclick=()=>{
  const u = document.getElementById("loginUsername").value.trim();
  const users = loadUsers();
  if(!users[u]) return alert("User not found!");
  const email = prompt("Enter your email:");
  if(email!==users[u].email) return alert("Email mismatch!");
  const newPass = prompt("Enter new password:");
  if(newPass){ users[u].password=newPass; saveUsers(users); alert("Password reset!"); }
};

/* ==== LOGOUT ==== */
logoutBtn.onclick=()=>{ currentUser=null; localStorage.removeItem("snakeCurrentUser"); startScreen.style.display="none"; loginScreen.style.display="block"; };

/* ==== START GAME ==== */
startBtn.onclick=startGame;
function startGame(){
  speed = parseInt(difficultySelect.value);
  startScreen.style.display="none";
  canvas.style.display="block";
  scoreDisplay.style.display="block";
  score = 0;
  scoreDisplay.textContent="Score: 0";
  snake=[{x:200,y:200}];
  spawnFood();
  d=null;
  document.addEventListener("keydown",control);
  gameInterval=setInterval(draw,speed);
}

/* ==== CONTROLS ==== */
function control(e){
  if(e.key==="ArrowLeft" && d!=="RIGHT") d="LEFT";
  if(e.key==="ArrowUp" && d!=="DOWN") d="UP";
  if(e.key==="ArrowRight" && d!=="LEFT") d="RIGHT";
  if(e.key==="ArrowDown" && d!=="UP") d="DOWN";
}

/* ==== SPAWN FOOD ==== */
function spawnFood(){
  food={x:Math.floor(Math.random()*20)*box, y:Math.floor(Math.random()*20)*box};
}

/* ==== COLLISION CHECK ==== */
function collision(head,array){ return array.some(s=>s.x===head.x && s.y===head.y); }

/* ==== DRAW GAME ==== */
function draw(){
  ctx.fillStyle="#111"; ctx.fillRect(0,0,400,400);
  snake.forEach((s,i)=>{ ctx.fillStyle=i===0?"#0f0":"#0a0"; ctx.fillRect(s.x,s.y,box,box); });
  ctx.fillStyle="#f00"; ctx.fillRect(food.x,food.y,box,box);

  let head={x:snake[0].x, y:snake[0].y};
  if(d==="LEFT") head.x-=box;
  if(d==="UP") head.y-=box;
  if(d==="RIGHT") head.x+=box;
  if(d==="DOWN") head.y+=box;

  if(head.x<0 || head.y<0 || head.x>=400 || head.y>=400 || collision(head,snake)){
    clearInterval(gameInterval);
    alert("Game Over!");
    updateHighScore();
    canvas.style.display="none";
    startScreen.style.display="block";
    return;
  }

  snake.unshift(head);
  if(head.x===food.x && head.y===food.y){
    score+=10; spawnFood();
  } else { snake.pop(); }

  scoreDisplay.textContent="Score: "+score;
}

/* ==== HIGH SCORE UPDATE ==== */
function updateHighScore(){
  const users=loadUsers();
  if(score>users[currentUser].highScore){
    users[currentUser].highScore=score;
    saveUsers(users);
  }
  updateScoreboard();
}

/* ==== DEBUG PANEL ==== */
debugToggle.onclick=()=>{ debugContent.style.display=debugContent.style.display==="block"?"none":"block"; };
pointsRange.oninput=()=>{ pointsValue.textContent=pointsRange.value; };
givePointsBtn.onclick=()=>{
  const users=loadUsers();
  const u=userSelect.value;
  users[u].highScore+=parseInt(pointsRange.value);
  saveUsers(users); updateScoreboard();
};
removePointsBtn.onclick=()=>{
  const users=loadUsers();
  const u=userSelect.value;
  users[u].highScore=Math.max(0, users[u].highScore-parseInt(pointsRange.value));
  saveUsers(users); updateScoreboard();
};
changePasswordBtn.onclick=()=>{
  const users=loadUsers();
  const u=userSelect.value;
  const newPass=prompt(`New password for ${u}:`);
  if(newPass){ users[u].password=newPass; saveUsers(users); alert("Password changed!"); }
};
changeUsernameBtn.onclick=()=>{
  const users=loadUsers();
  const oldU=userSelect.value;
  const newU=prompt(`New username for ${oldU}:`);
  if(!newU || users[newU]) return alert("Invalid or existing username!");
  users[newU]=users[oldU]; delete users[oldU]; saveUsers(users);
  if(currentUser===oldU){ currentUser=newU; localStorage.setItem("snakeCurrentUser",newU); }
  updateUserDropdown();
  playerInfo.textContent=`Logged in as: ${currentUser} | High Score: ${users[currentUser].highScore}`;
  alert("Username changed!");
};

/* ==== INITIAL SCREEN ==== */
function showStartScreen(){
  loginScreen.style.display="none";
  signupScreen.style.display="none";
  startScreen.style.display="block";
  canvas.style.display="none";
  scoreDisplay.style.display="none";
  playerInfo.textContent=`Logged in as: ${currentUser} | High Score: ${loadUsers()[currentUser].highScore}`;
  updateScoreboard();
  updateUserDropdown();
}

if(currentUser) showStartScreen();
</script>

</body>
</html>
